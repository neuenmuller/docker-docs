<!-- Page generated 2021-11-17 12:37:13 +0000-->
<!DOCTYPE html>
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
<title>Deploying Docker containers on Azure | Docker Documentation</title>
  <meta name="description" content="Deploying Docker containers on Azure" />
  <meta name="keywords" content="Docker, Azure, Integration, ACI, context, Compose, cli, deploy, containers, cloud">
  <link rel="canonical" href="https://docs.docker.com/cloud/aci-integration/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><script defer src="/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Deploying Docker containers on Azure"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="Deploying Docker containers on Azure" />
  <meta property="og:description" content="Deploying Docker containers on Azure" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-11-17T12:37:13+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/cloud/aci-integration/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-11-17T12:37:13+00:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Deploying Docker containers on Azure","description":"Deploying Docker containers on Azure","url":"https://docs.docker.com/cloud/aci-integration/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/get-started/overview/">Guides</a></li><li><a href="/cloud/aci-integration/">Deploy your app to the cloud</a></li><li><a href="/cloud/aci-integration/">Docker and ACI</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Deploying Docker containers on Azure</h1><p><em class="reading-time">Estimated reading time: 19 minutes</em></p><h2 id="overview">Overview</h2>

<p>The Docker Azure Integration enables developers to use native Docker commands to run applications in Azure Container Instances (ACI) when building cloud-native applications. The new experience provides a tight integration between Docker Desktop and Microsoft Azure allowing developers to quickly run applications using the Docker CLI or VS Code extension, to switch seamlessly from local development to cloud deployment.</p>

<p>In addition, the integration between Docker and Microsoft developer technologies allow developers to use the Docker CLI to:</p>

<ul>
  <li>Easily log into Azure</li>
  <li>Set up an ACI context in one Docker command allowing you to switch from a local context to a cloud context and run applications quickly and easily</li>
  <li>Simplify single container and multi-container application development using the Compose specification, allowing a developer to invoke fully Docker-compatible commands seamlessly for the first time natively within a cloud container service</li>
</ul>

<p>Also see the <a href="/cloud/aci-container-features/">full list of container features supported by ACI</a> and <a href="/cloud/aci-compose-features/">full list of compose features supported by ACI</a>.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To deploy Docker containers on Azure, you must meet the following requirements:</p>

<ol>
  <li>
    <p>Download and install the latest version of Docker Desktop.</p>

    <ul>
      <li><a href="/desktop/mac/install/">Download for Mac</a></li>
      <li><a href="/desktop/windows/install/">Download for Windows</a></li>
    </ul>

    <p>Alternatively, install the <a href="#install-the-docker-compose-cli-on-linux">Docker Compose CLI for Linux</a>.</p>
  </li>
  <li>
    <p>Ensure you have an Azure subscription. You can get started with an <a href="https://aka.ms/AA8r2pj" target="_blank" rel="noopener" class="_">Azure free account</a>.</p>
  </li>
</ol>

<h2 id="run-docker-containers-on-aci">Run Docker containers on ACI</h2>

<p>Docker not only runs containers locally, but also enables developers to seamlessly deploy Docker containers on ACI using <code class="highlighter-rouge">docker run</code> or deploy multi-container applications defined in a Compose file using the <code class="highlighter-rouge">docker compose up</code> command.</p>

<p>The following sections contain instructions on how to deploy your Docker containers on ACI.
Also see the <a href="/cloud/aci-container-features/">full list of container features supported by ACI</a>.</p>

<h3 id="log-into-azure">Log into Azure</h3>

<p>Run the following commands to log into Azure:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker login azure
</code></pre></div></div>

<p>This opens your web browser and prompts you to enter your Azure login credentials.
If the Docker CLI cannot open a browser, it will fall back to the <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code" target="_blank" rel="noopener" class="_">Azure device code flow</a> and lets you connect manually.
Note that the <a href="https://docs.microsoft.com/en-us/cli/azure/" target="_blank" rel="noopener" class="_">Azure command line</a> login is separated from the Docker CLI Azure login.</p>

<p>Alternatively, you can log in without interaction (typically in
scripts or continuous integration scenarios), using an Azure Service
Principal, with <code class="highlighter-rouge">docker login azure --client-id xx --client-secret yy --tenant-id zz</code></p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Logging in through the Azure Service Provider obtains an access token valid
for a short period (typically 1h), but it does not allow you to automatically
and transparently refresh this token. You must manually re-login
when the access token has expired when logging in with a Service Provider.</p>
</blockquote>

<p>You can also use the <code class="highlighter-rouge">--tenant-id</code> option alone to specify a tenant, if
you have several ones available in Azure.</p>

<h3 id="create-an-aci-context">Create an ACI context</h3>

<p>After you have logged in, you need to create a Docker context associated with ACI to deploy containers in ACI.
Creating an ACI context requires an Azure subscription, a <a href="https://docs.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal">resource group</a>, and a region.
For example, let us create a new context called <code class="highlighter-rouge">myacicontext</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker context create aci myacicontext
</code></pre></div></div>

<p>This command automatically uses your Azure login credentials to identify your subscription IDs and resource groups. You can then interactively select the subscription and group that you would like to use. If you prefer, you can specify these options in the CLI using the following flags: <code class="highlighter-rouge">--subscription-id</code>,
<code class="highlighter-rouge">--resource-group</code>, and <code class="highlighter-rouge">--location</code>.</p>

<p>If you don’t have any existing resource groups in your Azure account, the <code class="highlighter-rouge">docker context create aci myacicontext</code> command creates one for you. You don’t have to specify any additional options to do this.</p>

<p>After you have created an ACI context, you can list your Docker contexts by running the <code class="highlighter-rouge">docker context ls</code> command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">NAME                TYPE                DESCRIPTION                               DOCKER ENDPOINT                KUBERNETES ENDPOINT   ORCHESTRATOR
myacicontext        aci                 myResourceGroupGTA@eastus
default *           moby              Current DOCKER_HOST based configuration   unix:///var/run/docker.sock                          swarm
</span></code></pre></div></div>

<h3 id="run-a-container">Run a container</h3>

<p>Now that you’ve logged in and created an ACI context, you can start using Docker commands to deploy containers on ACI.</p>

<p>There are two ways to use your new ACI context. You can use the <code class="highlighter-rouge">--context</code> flag with the Docker command to specify that you would like to run the command using your newly created ACI context.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> myacicontext run <span class="nt">-p</span> 80:80 nginx
</code></pre></div></div>

<p>Or, you can change context using <code class="highlighter-rouge">docker context use</code> to select the ACI context to be your focus for running Docker commands. For example, we can use the <code class="highlighter-rouge">docker context use</code> command to deploy an Nginx container:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker context use myacicontext
<span class="gp">$</span> docker run <span class="nt">-p</span> 80:80 nginx
</code></pre></div></div>

<p>After you’ve switched to the <code class="highlighter-rouge">myacicontext</code> context, you can use <code class="highlighter-rouge">docker ps</code> to list your containers running on ACI.</p>

<p>In the case of the demonstration Nginx container started above, the result of the ps command will display in column “PORTS” the IP address and port on which the container is running. For example, it may show <code class="highlighter-rouge">52.154.202.35:80-&gt;80/tcp</code>, and you can view the Nginx welcome page by browsing <code class="highlighter-rouge">http://52.154.202.35</code>.</p>

<p>To view logs from your container, run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker logs &lt;CONTAINER_ID&gt;
</code></pre></div></div>

<p>To execute a command in a running container, run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nb">exec</span> <span class="nt">-t</span> &lt;CONTAINER_ID&gt; COMMAND
</code></pre></div></div>

<p>To stop and remove a container from ACI, run:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker stop &lt;CONTAINER_ID&gt;
<span class="gp">$</span> docker rm &lt;CONTAINER_ID&gt;
</code></pre></div></div>

<p>You can remove containers using <code class="highlighter-rouge">docker rm</code>. To remove a running container, you must use the <code class="highlighter-rouge">--force</code> flag, or stop the container using <code class="highlighter-rouge">docker stop</code> before removing it.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The semantics of restarting a container on ACI are different to those when using a local Docker context for local development. On ACI, the container will be reset to its initial state and started on a new node. This includes the container’s filesystem so all state that is not stored in a volume will be lost on restart.</p>
</blockquote>

<h2 id="running-compose-applications">Running Compose applications</h2>

<p>You can also deploy and manage multi-container applications defined in Compose files to ACI using the <code class="highlighter-rouge">docker compose</code> command.
All containers in the same Compose application are started in the same container group. Service discovery between the containers works using the service name specified in the Compose file.
Name resolution between containers is achieved by writing service names in the <code class="highlighter-rouge">/etc/hosts</code> file that is shared automatically by all containers in the container group.</p>

<p>Also see the <a href="/cloud/aci-compose-features/">full list of compose features supported by ACI</a>.</p>

<ol>
  <li>
    <p>Ensure you are using your ACI context. You can do this either by specifying the <code class="highlighter-rouge">--context myacicontext</code> flag or by setting the default context using the command  <code class="highlighter-rouge">docker context use myacicontext</code>.</p>
  </li>
  <li>
    <p>Run <code class="highlighter-rouge">docker compose up</code> and <code class="highlighter-rouge">docker compose down</code> to start and then stop a full Compose application.</p>
  </li>
</ol>

<p>By default, <code class="highlighter-rouge">docker compose up</code> uses the <code class="highlighter-rouge">docker-compose.yaml</code> file in the current folder. You can specify the working directory using the --workdir flag or specify the Compose file directly using <code class="highlighter-rouge">docker compose --file mycomposefile.yaml up</code>.</p>

<p>You can also specify a name for the Compose application using the <code class="highlighter-rouge">--project-name</code> flag during deployment. If no name is specified, a name will be derived from the working directory.</p>

<p>Containers started as part of Compose applications will be displayed along with single containers when using <code class="highlighter-rouge">docker ps</code>. Their container ID will be of the format: <code class="highlighter-rouge">&lt;COMPOSE-PROJECT&gt;_&lt;SERVICE&gt;</code>.
  These containers cannot be stopped, started, or removed independently since they are all part of the same ACI container group.
  You can view each container’s logs with <code class="highlighter-rouge">docker logs</code>. You can list deployed Compose applications with <code class="highlighter-rouge">docker compose ls</code>. This will list only compose applications, not single containers started with <code class="highlighter-rouge">docker run</code>. You can remove a Compose application with <code class="highlighter-rouge">docker compose down</code>.</p>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The current Docker Azure integration does not allow fetching a combined log stream from all the containers that make up the Compose application.</p>
</blockquote>

<h2 id="updating-applications">Updating applications</h2>

<p>From a deployed Compose application, you can update the application by re-deploying it with the same project name: <code class="highlighter-rouge">docker compose --project-name PROJECT up</code>.</p>

<p>Updating an application means the ACI node will be reused, and the application will keep the same IP address that was previously allocated to expose ports, if any. ACI has some limitations on what can be updated in an existing application (you will not be able to change CPU/memory reservation for example), in these cases, you need to deploy a new application from scratch.</p>

<p>Updating is the default behavior if you invoke <code class="highlighter-rouge">docker compose up</code> on an already deployed Compose file, as the Compose project name is derived from the directory where the Compose file is located by default. You need to explicitly execute <code class="highlighter-rouge">docker compose down</code> before running <code class="highlighter-rouge">docker compose up</code> again in order to totally reset a Compose application.</p>

<h2 id="releasing-resources">Releasing resources</h2>

<p>Single containers and Compose applications can be removed from ACI with
the <code class="highlighter-rouge">docker prune</code> command. The <code class="highlighter-rouge">docker prune</code> command removes deployments
that are not currently running. To remove running depoyments, you can specify
<code class="highlighter-rouge">--force</code>. The <code class="highlighter-rouge">--dry-run</code> option lists deployments that are planned for
removal, but it doesn’t actually remove them.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> ./bin/docker <span class="nt">--context</span> acicontext prune <span class="nt">--dry-run</span> <span class="nt">--force</span>
<span class="go">Resources that would be deleted:
my-application
Total CPUs reclaimed: 2.01, total memory reclaimed: 2.30 GB
</span></code></pre></div></div>

<h2 id="exposing-ports">Exposing ports</h2>

<p>Single containers and Compose applications can optionally expose ports.
For single containers, this is done using the <code class="highlighter-rouge">--publish</code> (<code class="highlighter-rouge">-p</code>) flag of the <code class="highlighter-rouge">docker run</code> command : <code class="highlighter-rouge">docker run -p 80:80 nginx</code>.</p>

<p>For Compose applications, you must specify exposed ports in the Compose file service definition:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>ACI does not allow port mapping (that is, changing port number while exposing port). Therefore, the source and target ports must be the same when deploying to ACI.</p>

  <p>All containers in the same Compose application are deployed in the same ACI container group. Different containers in the same Compose application cannot expose the same port when deployed to ACI.</p>
</blockquote>

<p>By default, when exposing ports for your application, a random public IP address is associated with the container group supporting the deployed application (single container or Compose application).
This IP address can be obtained when listing containers with <code class="highlighter-rouge">docker ps</code> or using <code class="highlighter-rouge">docker inspect</code>.</p>

<h3 id="dns-label-name">DNS label name</h3>

<p>In addition to exposing ports on a random IP address, you can specify a DNS label name to expose your application on an FQDN of the form: <code class="highlighter-rouge">&lt;NAME&gt;.region.azurecontainer.io</code>.</p>

<p>You can set this name with the <code class="highlighter-rouge">--domainname</code> flag when performing a <code class="highlighter-rouge">docker run</code>, or by using the <code class="highlighter-rouge">domainname</code> field in the Compose file when performing a <code class="highlighter-rouge">docker compose up</code>:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">nginx</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">domainname</span><span class="pi">:</span> <span class="s2">"</span><span class="s">myapp"</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The domain of a Compose application can only be set once, if you specify the
<code class="highlighter-rouge">domainname</code> for several services, the value must be identical.</p>

  <p>The FQDN <code class="highlighter-rouge">&lt;DOMAINNAME&gt;.region.azurecontainer.io</code> must be available.</p>
</blockquote>

<h2 id="using-azure-file-share-as-volumes-in-aci-containers">Using Azure file share as volumes in ACI containers</h2>

<p>You can deploy containers or Compose applications that use persistent data
stored in volumes. Azure File Share can be used to support volumes for ACI
containers.</p>

<p>Using an existing Azure File Share with storage account name <code class="highlighter-rouge">mystorageaccount</code>
and file share name <code class="highlighter-rouge">myfileshare</code>, you can specify a volume in your deployment <code class="highlighter-rouge">run</code>
command as follows:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker run <span class="nt">-v</span> mystorageaccount/myfileshare:/target/path myimage
</code></pre></div></div>

<p>The runtime container will see the file share content in <code class="highlighter-rouge">/target/path</code>.</p>

<p>In a Compose application, the volume specification must use the following syntax
in the Compose file:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">myservice</span><span class="pi">:</span>
  <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
  <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">mydata:/mount/testvolumes</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">mydata</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">azure_file</span>
    <span class="na">driver_opts</span><span class="pi">:</span>
      <span class="na">share_name</span><span class="pi">:</span> <span class="s">myfileshare</span>
      <span class="na">storage_account_name</span><span class="pi">:</span> <span class="s">mystorageaccount</span>
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The volume short syntax in Compose files cannot be used as it is aimed at volume definition for local bind mounts. Using the volume driver and driver option syntax in Compose files makes the volume definition a lot more clear.</p>
</blockquote>

<p>In single or multi-container deployments, the Docker CLI will use your Azure login to fetch the key to the storage account, and provide this key with the container deployment information, so that the container can access the volume.
Volumes can be used from any file share in any storage account you have access to with your Azure login. You can specify <code class="highlighter-rouge">rw</code> (read/write) or <code class="highlighter-rouge">ro</code> (read only) when mounting the volume (<code class="highlighter-rouge">rw</code> is the default).</p>

<h3 id="managing-azure-volumes">Managing Azure volumes</h3>

<p>To create a volume that you can use in containers or Compose applications when
using your ACI Docker context, you can use the <code class="highlighter-rouge">docker volume create</code> command,
and specify an Azure storage account name and the file share name:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> aci volume create test-volume <span class="nt">--storage-account</span> mystorageaccount
<span class="go">[+] Running 2/2
 ⠿ mystorageaccount  Created                         26.2s
 ⠿ test-volume       Created                          0.9s
mystorageaccount/test-volume
</span></code></pre></div></div>

<p>By default, if the storage account does not already exist, this command
creates a new storage account using the Standard LRS as a default SKU, and the
resource group and location associated with your Docker ACI context.</p>

<p>If you specify an existing storage account, the command creates a new
file share in the existing account:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> aci volume create test-volume2 <span class="nt">--storage-account</span> mystorageaccount
<span class="go">[+] Running 2/2
 ⠿ mystorageaccount   Use existing                    0.7s
 ⠿ test-volume2       Created                         0.7s
mystorageaccount/test-volume2
</span></code></pre></div></div>

<p>Alternatively, you can create an Azure storage account or a file share using the Azure
portal, or the <code class="highlighter-rouge">az</code> <a href="https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-cli">command line</a>.</p>

<p>You can also list volumes that are available for use in containers or Compose applications:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> aci volume <span class="nb">ls</span>
<span class="go">ID                                 DESCRIPTION
mystorageaccount/test-volume       Fileshare test-volume in mystorageaccount storage account
mystorageaccount/test-volume2      Fileshare test-volume2 in mystorageaccount storage account
</span></code></pre></div></div>

<p>To delete a volume and the corresponding Azure file share, use the <code class="highlighter-rouge">volume rm</code> command:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> aci volume rm mystorageaccount/test-volume
<span class="go">mystorageaccount/test-volume
</span></code></pre></div></div>

<p>This permanently deletes the Azure file share and all its data.</p>

<p>When deleting a volume in Azure, the command checks whether the specified file share
is the only file share available in the storage account. If the storage account is
created with the <code class="highlighter-rouge">docker volume create</code> command, <code class="highlighter-rouge">docker volume rm</code> also
deletes the storage account when it does not have any file shares.
If you are using a storage account created without the <code class="highlighter-rouge">docker volume create</code> command
(through Azure portal or with the <code class="highlighter-rouge">az</code> command line for example), <code class="highlighter-rouge">docker volume rm</code>
does not delete the storage account, even when it has zero remaining file shares.</p>

<h2 id="environment-variables">Environment variables</h2>

<p>When using <code class="highlighter-rouge">docker run</code>, you can pass the environment variables to ACI containers using the <code class="highlighter-rouge">--env</code> flag.
For Compose applications, you can specify the environment variables in the Compose file with the <code class="highlighter-rouge">environment</code> or <code class="highlighter-rouge">env-file</code> service field, or with the <code class="highlighter-rouge">--environment</code> command line flag.</p>

<h2 id="health-checks">Health checks</h2>

<p>You can specify a container health checks using either the <code class="highlighter-rouge">--healthcheck-</code> prefixed flags with <code class="highlighter-rouge">docker run</code>, or in a Compose file with the <code class="highlighter-rouge">healthcheck</code> section of the service.</p>

<p>Health checks are converted to ACI <code class="highlighter-rouge">LivenessProbe</code>s. ACI runs the health check command periodically, and if it fails, the container will be terminated.</p>

<p>Health checks must be used in addition to restart policies to ensure the container is then restarted on termination. The default restart policy for <code class="highlighter-rouge">docker run</code> is <code class="highlighter-rouge">no</code> which will not restart the container. The default restart policy for Compose is <code class="highlighter-rouge">any</code> which will always try restarting the service containers.</p>

<p>Example using <code class="highlighter-rouge">docker run</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker <span class="nt">--context</span> acicontext run <span class="nt">-p</span> 80:80 <span class="nt">--restart</span> always <span class="nt">--health-cmd</span> <span class="s2">"curl http://localhost:80"</span> <span class="nt">--health-interval</span> 3s  nginx
</code></pre></div></div>

<p>Example using Compose files:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">deploy</span><span class="pi">:</span>
      <span class="na">restart_policy</span><span class="pi">:</span>
        <span class="na">condition</span><span class="pi">:</span> <span class="s">on-failure</span>
    <span class="na">healthcheck</span><span class="pi">:</span>
      <span class="na">test</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">CMD"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">curl"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">-f"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">http://localhost:80"</span><span class="pi">]</span>
      <span class="na">interval</span><span class="pi">:</span> <span class="s">10s</span>
</code></pre></div></div>

<h2 id="private-docker-hub-images-and-using-the-azure-container-registry">Private Docker Hub images and using the Azure Container Registry</h2>

<p>You can deploy private images to ACI that are hosted by any container registry. You need to log into the relevant registry using <code class="highlighter-rouge">docker login</code> before running <code class="highlighter-rouge">docker run</code> or <code class="highlighter-rouge">docker compose up</code>. The Docker CLI will fetch your registry login for the deployed images and send the credentials along with the image deployment information to ACI.
In the case of the Azure Container Registry, the command line will try to automatically log you into ACR from your Azure login. You don’t need to manually login to the ACR registry first, if your Azure login has access to the ACR.</p>

<h2 id="using-aci-resource-groups-as-namespaces">Using ACI resource groups as namespaces</h2>

<p>You can create several Docker contexts associated with ACI. Each context must be associated with a unique Azure resource group. This allows you to use Docker contexts as namespaces. You can switch between namespaces using <code class="highlighter-rouge">docker context use &lt;CONTEXT&gt;</code>.</p>

<p>When you run the <code class="highlighter-rouge">docker ps</code> command, it only lists containers in your current Docker context. There won’t be any contention in container names or Compose application names between two Docker contexts.</p>

<h2 id="install-the-docker-compose-cli-on-linux">Install the Docker Compose CLI on Linux</h2>

<p>The Docker Compose CLI adds support for running and managing containers on Azure Container Instances (ACI).</p>

<h3 id="install-prerequisites">Install Prerequisites</h3>

<ul>
  <li><a href="/get-docker/">Docker 19.03 or later</a></li>
</ul>

<h3 id="install-script">Install script</h3>

<p>You can install the new CLI using the install script:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> curl <span class="nt">-L</span> https://raw.githubusercontent.com/docker/compose-cli/main/scripts/install/install_linux.sh | sh
</code></pre></div></div>

<h3 id="manual-install">Manual install</h3>

<p>You can download the Docker ACI Integration CLI from the
<a href="https://github.com/docker/compose-cli/releases/latest" target="_blank" rel="noopener" class="_">latest release</a> page.</p>

<p>You will then need to make it executable:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> chmod +x docker-aci
</code></pre></div></div>

<p>To enable using the local Docker Engine and to use existing Docker contexts, you
must have the existing Docker CLI as <code class="highlighter-rouge">com.docker.cli</code> somewhere in your
<code class="highlighter-rouge">PATH</code>. You can do this by creating a symbolic link from the existing Docker
CLI:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> ln <span class="nt">-s</span> /path/to/existing/docker /directory/in/PATH/com.docker.cli
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>The <code class="highlighter-rouge">PATH</code> environment variable is a colon-separated list of
directories with priority from left to right. You can view it using
<code class="highlighter-rouge">echo $PATH</code>. You can find the path to the existing Docker CLI using
<code class="highlighter-rouge">which docker</code>. You may need root permissions to make this link.</p>
</blockquote>

<p>On a fresh install of Ubuntu 20.04 with Docker Engine
<a href="/engine/install/ubuntu/">already installed</a>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$PATH</span>
<span class="go">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</span><span class="gp">$</span> which docker
<span class="go">/usr/bin/docker
</span><span class="gp">$</span> <span class="nb">sudo </span>ln <span class="nt">-s</span> /usr/bin/docker /usr/local/bin/com.docker.cli
</code></pre></div></div>

<p>You can verify that this is working by checking that the new CLI works with the
default context:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> ./docker-aci <span class="nt">--context</span> default ps
<span class="go">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES
</span><span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$?</span>
<span class="go">0
</span></code></pre></div></div>

<p>To make this CLI with ACI integration your default Docker CLI, you must move it
to a directory in your <code class="highlighter-rouge">PATH</code> with higher priority than the existing Docker CLI.</p>

<p>Again, on a fresh Ubuntu 20.04:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> which docker
<span class="go">/usr/bin/docker
</span><span class="gp">$</span> <span class="nb">echo</span> <span class="nv">$PATH</span>
<span class="go">/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</span><span class="gp">$</span> <span class="nb">sudo </span>mv docker-aci /usr/local/bin/docker
<span class="gp">$</span> which docker
<span class="go">/usr/local/bin/docker
</span><span class="gp">$</span> docker version
<span class="c">...
</span><span class="go"> Azure integration  0.1.4
</span><span class="c">...
</span></code></pre></div></div>

<h3 id="supported-commands">Supported commands</h3>

<p>After you have installed the Docker ACI Integration CLI, run <code class="highlighter-rouge">--help</code> to see the current list of commands.</p>

<h3 id="uninstall">Uninstall</h3>

<p>To remove the Docker Azure Integration CLI, you need to remove the binary you downloaded and <code class="highlighter-rouge">com.docker.cli</code> from your <code class="highlighter-rouge">PATH</code>. If you installed using the script, this can be done as follows:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">sudo </span>rm /usr/local/bin/docker /usr/local/bin/com.docker.cli
</code></pre></div></div>

<h2 id="feedback">Feedback</h2>

<p>Thank you for trying out Docker Azure Integration. Your feedback is very important to us. Let us know your feedback by creating an issue in the <a href="https://github.com/docker/compose-cli" target="_blank" rel="noopener" class="_">compose-cli</a> GitHub repository.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/search/?q=Docker">Docker</a>, <a href="/search/?q=Azure">Azure</a>, <a href="/search/?q=Integration">Integration</a>, <a href="/search/?q=ACI">ACI</a>, <a href="/search/?q=context">context</a>, <a href="/search/?q=Compose">Compose</a>, <a href="/search/?q=cli">cli</a>, <a href="/search/?q=deploy">deploy</a>, <a href="/search/?q=containers">containers</a>, <a href="/search/?q=cloud">cloud</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/docker/docker.github.io/edit/master/cloud/aci-integration.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [cloud/aci-integration.md](https://docs.docker.com/cloud/aci-integration/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#overview" class="nomunge">Overview</a>
    <ul>
      <li><a href="#prerequisites" class="nomunge">Prerequisites</a></li>
      <li><a href="#run-docker-containers-on-aci" class="nomunge">Run Docker containers on ACI</a></li>
      <li><a href="#running-compose-applications" class="nomunge">Running Compose applications</a></li>
      <li><a href="#updating-applications" class="nomunge">Updating applications</a></li>
      <li><a href="#releasing-resources" class="nomunge">Releasing resources</a></li>
      <li><a href="#exposing-ports" class="nomunge">Exposing ports</a></li>
      <li><a href="#using-azure-file-share-as-volumes-in-aci-containers" class="nomunge">Using Azure file share as volumes in ACI containers</a></li>
      <li><a href="#environment-variables" class="nomunge">Environment variables</a></li>
      <li><a href="#health-checks" class="nomunge">Health checks</a></li>
      <li><a href="#private-docker-hub-images-and-using-the-azure-container-registry" class="nomunge">Private Docker Hub images and using the Azure Container Registry</a></li>
      <li><a href="#using-aci-resource-groups-as-namespaces" class="nomunge">Using ACI resource groups as namespaces</a></li>
      <li><a href="#install-the-docker-compose-cli-on-linux" class="nomunge">Install the Docker Compose CLI on Linux</a></li>
      <li><a href="#feedback" class="nomunge">Feedback</a></li>
    </ul>
  </li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker?</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container?</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker Product Roadmap</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQs</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker Verified Publisher Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/cloud/aci-integration/";</script><script>
    let PDRTJS_settings_8453675 = {
        "id": "8453675",
        "unique_id": "cloud/aci-integration.md",
        "title": "Deploying Docker containers on Azure",
        "font_family": "Open Sans, sans serif",
        "font_color": "b9c2cc",
        "font_align": "center",
        "permalink": "https://github.com/docker/docker.github.io/blob/master/cloud/aci-integration.md"
    };
    (function (d, c, j) {
        if (!document.getElementById(j)) {
            let pd=d.createElement(c),s;pd.id=j;pd.src='https://polldaddy.com/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd, s);
        }
    }(document, 'script', 'pd-rating-js'));
</script></body>
</html>
