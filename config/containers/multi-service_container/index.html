<!-- Page generated 2021-11-17 12:16:07 +0000-->
<!DOCTYPE html>
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
<title>Run multiple services in a container | Docker Documentation</title>
  <meta name="description" content="How to run more than one process in a container" />
  <meta name="keywords" content="docker, supervisor, process management">
  <link rel="canonical" href="https://docs.docker.com/config/containers/multi-service_container/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><script defer src="/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Run multiple services in a container"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="Run multiple services in a container" />
  <meta property="og:description" content="How to run more than one process in a container" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-11-17T12:16:07+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/config/containers/multi-service_container/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-11-17T12:16:07+00:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Run multiple services in a container","description":"How to run more than one process in a container","url":"https://docs.docker.com/config/containers/multi-service_container/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/get-started/overview/">Guides</a></li><li><a>Run your app in production</a></li><li><a href="/config/containers/start-containers-automatically/">Configure containers</a></li><li><a href="/config/containers/multi-service_container/">Run multiple services in a container</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Run multiple services in a container</h1><p><em class="reading-time">Estimated reading time: 4 minutes</em></p><p>A container’s main running process is the <code class="highlighter-rouge">ENTRYPOINT</code> and/or <code class="highlighter-rouge">CMD</code> at the
end of the <code class="highlighter-rouge">Dockerfile</code>. It is generally recommended that you separate areas of
concern by using one service per container. That service may fork into multiple
processes (for example, Apache web server starts multiple worker processes).
It’s ok to have multiple processes, but to get the most benefit out of Docker,
avoid one container being responsible for multiple aspects of your overall
application. You can connect multiple containers using user-defined networks and
shared volumes.</p>

<p>The container’s main process is responsible for managing all processes that it
starts. In some cases, the main process isn’t well-designed, and doesn’t handle
“reaping” (stopping) child processes gracefully when the container exits. If
your process falls into this category, you can use the <code class="highlighter-rouge">--init</code> option when you
run the container. The <code class="highlighter-rouge">--init</code> flag inserts a tiny init-process into the
container as the main process, and handles reaping of all processes when the
container exits. Handling such processes this way is superior to using a
full-fledged init process such as <code class="highlighter-rouge">sysvinit</code>, <code class="highlighter-rouge">upstart</code>, or <code class="highlighter-rouge">systemd</code> to handle
process lifecycle within your container.</p>

<p>If you need to run more than one service within a container, you can accomplish
this in a few different ways.</p>

<ul>
  <li>
    <p>Put all of your commands in a wrapper script, complete with testing and
debugging information. Run the wrapper script as your <code class="highlighter-rouge">CMD</code>. This is a very
naive example. First, the wrapper script:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

<span class="c"># Start the first process</span>
./my_first_process <span class="nt">-D</span>
<span class="nv">status</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$status</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Failed to start my_first_process: </span><span class="nv">$status</span><span class="s2">"</span>
  <span class="nb">exit</span> <span class="nv">$status</span>
<span class="k">fi</span>

<span class="c"># Start the second process</span>
./my_second_process <span class="nt">-D</span>
<span class="nv">status</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">if</span> <span class="o">[</span> <span class="nv">$status</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
  </span><span class="nb">echo</span> <span class="s2">"Failed to start my_second_process: </span><span class="nv">$status</span><span class="s2">"</span>
  <span class="nb">exit</span> <span class="nv">$status</span>
<span class="k">fi</span>

<span class="c"># Naive check runs checks once a minute to see if either of the processes exited.</span>
<span class="c"># This illustrates part of the heavy lifting you need to do if you want to run</span>
<span class="c"># more than one service in a container. The container exits with an error</span>
<span class="c"># if it detects that either of the processes has exited.</span>
<span class="c"># Otherwise it loops forever, waking up every 60 seconds</span>

<span class="k">while </span>sleep 60<span class="p">;</span> <span class="k">do
  </span>ps aux |grep my_first_process |grep <span class="nt">-q</span> <span class="nt">-v</span> <span class="nb">grep
  </span><span class="nv">PROCESS_1_STATUS</span><span class="o">=</span><span class="nv">$?</span>
  ps aux |grep my_second_process |grep <span class="nt">-q</span> <span class="nt">-v</span> <span class="nb">grep
  </span><span class="nv">PROCESS_2_STATUS</span><span class="o">=</span><span class="nv">$?</span>
  <span class="c"># If the greps above find anything, they exit with 0 status</span>
  <span class="c"># If they are not both 0, then something is wrong</span>
  <span class="k">if</span> <span class="o">[</span> <span class="nv">$PROCESS_1_STATUS</span> <span class="nt">-ne</span> 0 <span class="nt">-o</span> <span class="nv">$PROCESS_2_STATUS</span> <span class="nt">-ne</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"One of the processes has already exited."</span>
    <span class="nb">exit </span>1
  <span class="k">fi
done</span>
</code></pre></div>    </div>

    <p>Next, the Dockerfile:</p>

    <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>
<span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<span class="k">COPY</span><span class="s"> my_first_process my_first_process</span>
<span class="k">COPY</span><span class="s"> my_second_process my_second_process</span>
<span class="k">COPY</span><span class="s"> my_wrapper_script.sh my_wrapper_script.sh</span>
<span class="k">CMD</span><span class="s"> ./my_wrapper_script.sh</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>If you have one main process that needs to start first and stay running but
you temporarily need to run some other processes (perhaps to interact with
the main process) then you can use bash’s job control to facilitate that.
First, the wrapper script:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
  
<span class="c"># turn on bash's job control</span>
<span class="nb">set</span> <span class="nt">-m</span>
  
<span class="c"># Start the primary process and put it in the background</span>
./my_main_process &amp;
  
<span class="c"># Start the helper process</span>
./my_helper_process
  
<span class="c"># the my_helper_process might need to know how to wait on the</span>
<span class="c"># primary process to start before it does its work and returns</span>
  
  
<span class="c"># now we bring the primary process back into the foreground</span>
<span class="c"># and leave it there</span>
<span class="nb">fg</span> %1
</code></pre></div>    </div>

    <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>
<span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<span class="k">COPY</span><span class="s"> my_main_process my_main_process</span>
<span class="k">COPY</span><span class="s"> my_helper_process my_helper_process</span>
<span class="k">COPY</span><span class="s"> my_wrapper_script.sh my_wrapper_script.sh</span>
<span class="k">CMD</span><span class="s"> ./my_wrapper_script.sh</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Use a process manager like <code class="highlighter-rouge">supervisord</code>. This is a moderately heavy-weight
approach that requires you to package <code class="highlighter-rouge">supervisord</code> and its configuration in
your image (or base your image on one that includes <code class="highlighter-rouge">supervisord</code>), along with
the different applications it manages. Then you start <code class="highlighter-rouge">supervisord</code>, which
manages your processes for you. Here is an example Dockerfile using this
approach, that assumes the pre-written <code class="highlighter-rouge">supervisord.conf</code>, <code class="highlighter-rouge">my_first_process</code>,
and <code class="highlighter-rouge">my_second_process</code> files all exist in the same directory as your
Dockerfile.</p>

    <div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># syntax=docker/dockerfile:1</span>
<span class="k">FROM</span><span class="s"> ubuntu:latest</span>
<span class="k">RUN </span>apt-get update <span class="o">&amp;&amp;</span> apt-get install <span class="nt">-y</span> supervisor
<span class="k">RUN </span>mkdir <span class="nt">-p</span> /var/log/supervisor
<span class="k">COPY</span><span class="s"> supervisord.conf /etc/supervisor/conf.d/supervisord.conf</span>
<span class="k">COPY</span><span class="s"> my_first_process my_first_process</span>
<span class="k">COPY</span><span class="s"> my_second_process my_second_process</span>
<span class="k">CMD</span><span class="s"> ["/usr/bin/supervisord"]</span>
</code></pre></div>    </div>
  </li>
</ul>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/search/?q=docker">docker</a>, <a href="/search/?q=supervisor">supervisor</a>, <a href="/search/?q=process management">process management</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/docker/docker.github.io/edit/master/config/containers/multi-service_container.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [config/containers/multi-service_container.md](https://docs.docker.com/config/containers/multi-service_container/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker?</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container?</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker Product Roadmap</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQs</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker Verified Publisher Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/config/containers/multi-service_container/";</script><script>
    let PDRTJS_settings_8453675 = {
        "id": "8453675",
        "unique_id": "config/containers/multi-service_container.md",
        "title": "Run multiple services in a container",
        "font_family": "Open Sans, sans serif",
        "font_color": "b9c2cc",
        "font_align": "center",
        "permalink": "https://github.com/docker/docker.github.io/blob/master/config/containers/multi-service_container.md"
    };
    (function (d, c, j) {
        if (!document.getElementById(j)) {
            let pd=d.createElement(c),s;pd.id=j;pd.src='https://polldaddy.com/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd, s);
        }
    }(document, 'script', 'pd-rating-js'));
</script></body>
</html>
