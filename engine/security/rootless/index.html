<!-- Page generated 2021-11-17 12:37:13 +0000-->
<!DOCTYPE html>
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
<title>Run the Docker daemon as a non-root user (Rootless mode) | Docker Documentation</title>
  <meta name="description" content="Run the Docker daemon as a non-root user (Rootless mode)" />
  <meta name="keywords" content="security, namespaces, rootless">
  <link rel="canonical" href="https://docs.docker.com/engine/security/rootless/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><script defer src="/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Run the Docker daemon as a non-root user (Rootless mode)"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="Run the Docker daemon as a non-root user (Rootless mode)" />
  <meta property="og:description" content="Run the Docker daemon as a non-root user (Rootless mode)" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-11-17T12:37:13+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/engine/security/rootless/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-11-17T12:37:13+00:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Run the Docker daemon as a non-root user (Rootless mode)","description":"Run the Docker daemon as a non-root user (Rootless mode)","url":"https://docs.docker.com/engine/security/rootless/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/get-started/overview/">Guides</a></li><li><a>Run your app in production</a></li><li><a href="/config/containers/start-containers-automatically/">Configure containers</a></li><li><a href="/engine/security/">Security</a></li><li><a href="/engine/security/rootless/">Rootless mode</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Run the Docker daemon as a non-root user (Rootless mode)</h1><p><em class="reading-time">Estimated reading time: 19 minutes</em></p><p>Rootless mode allows running the Docker daemon and containers as a non-root
user to mitigate potential vulnerabilities in the daemon and
the container runtime.</p>

<p>Rootless mode does not require root privileges even during the installation of
the Docker daemon, as long as the <a href="#prerequisites">prerequisites</a> are met.</p>

<p>Rootless mode was introduced in Docker Engine v19.03 as an experimental feature.
Rootless mode graduated from experimental in Docker Engine v20.10.</p>

<h2 id="how-it-works">How it works</h2>

<p>Rootless mode executes the Docker daemon and containers inside a user namespace.
This is very similar to <a href="/engine/security/userns-remap/"><code class="highlighter-rouge">userns-remap</code> mode</a>, except that
with <code class="highlighter-rouge">userns-remap</code> mode, the daemon itself is running with root privileges,
whereas in rootless mode, both the daemon and the container are running without
root privileges.</p>

<p>Rootless mode does not use binaries with <code class="highlighter-rouge">SETUID</code> bits or file capabilities,
except <code class="highlighter-rouge">newuidmap</code> and <code class="highlighter-rouge">newgidmap</code>, which are needed to allow multiple
UIDs/GIDs to be used in the user namespace.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>
    <p>You must install <code class="highlighter-rouge">newuidmap</code> and <code class="highlighter-rouge">newgidmap</code> on the host. These commands
  are provided by the <code class="highlighter-rouge">uidmap</code> package on most distros.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">/etc/subuid</code> and <code class="highlighter-rouge">/etc/subgid</code> should contain at least 65,536 subordinate
UIDs/GIDs for the user. In the following example, the user <code class="highlighter-rouge">testuser</code> has
65,536 subordinate UIDs/GIDs (231072-296607).</p>
  </li>
</ul>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> id <span class="nt">-u</span>
<span class="go">1001
</span><span class="gp">$</span> whoami
<span class="go">testuser
</span><span class="gp">$</span> <span class="nb">grep</span> ^<span class="k">$(</span>whoami<span class="k">)</span>: /etc/subuid
<span class="go">testuser:231072:65536
</span><span class="gp">$</span> <span class="nb">grep</span> ^<span class="k">$(</span>whoami<span class="k">)</span>: /etc/subgid
<span class="go">testuser:231072:65536
</span></code></pre></div></div>

<h3 id="distribution-specific-hint">Distribution-specific hint</h3>

<blockquote>
  <p>Note: We recommend that you use the Ubuntu kernel.</p>
</blockquote>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#hint-ubuntu">Ubuntu</a></li>
  <li><a data-toggle="tab" data-target="#hint-debian">Debian GNU/Linux</a></li>
  <li><a data-toggle="tab" data-target="#hint-arch">Arch Linux</a></li>
  <li><a data-toggle="tab" data-target="#hint-opensuse-sles">openSUSE and SLES</a></li>
  <li><a data-toggle="tab" data-target="#hint-centos8-rhel8-fedora">CentOS 8, RHEL 8 and Fedora</a></li>
  <li><a data-toggle="tab" data-target="#hint-centos7-rhel7">CentOS 7 and RHEL 7</a></li>
</ul>
<div class="tab-content">
  <div id="hint-ubuntu" class="tab-pane fade in active">
    <ul>
      <li>
        <p>Install <code class="highlighter-rouge">dbus-user-session</code> package if not installed. Run <code class="highlighter-rouge">sudo apt-get install -y dbus-user-session</code> and relogin.</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">overlay2</code> storage driver  is enabled by default
(<a href="https://kernel.ubuntu.com/git/ubuntu/ubuntu-bionic.git/commit/fs/overlayfs?id=3b7da90f28fe1ed4b79ef2d994c81efbc58f1144">Ubuntu-specific kernel patch</a>).</p>
      </li>
      <li>
        <p>Known to work on Ubuntu 18.04, 20.04, and 21.04.</p>
      </li>
    </ul>
  </div>
  <div id="hint-debian" class="tab-pane fade in">
    <ul>
      <li>
        <p>Install <code class="highlighter-rouge">dbus-user-session</code> package if not installed. Run <code class="highlighter-rouge">sudo apt-get install -y dbus-user-session</code> and relogin.</p>
      </li>
      <li>
        <p>For Debian 10, add <code class="highlighter-rouge">kernel.unprivileged_userns_clone=1</code> to <code class="highlighter-rouge">/etc/sysctl.conf</code> (or
<code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code>. This step is not required on Debian 11.</p>
      </li>
      <li>
        <p>Installing <code class="highlighter-rouge">fuse-overlayfs</code> is recommended. Run <code class="highlighter-rouge">sudo apt-get install -y fuse-overlayfs</code>.
Using <code class="highlighter-rouge">overlay2</code> storage driver with Debian-specific modprobe option <code class="highlighter-rouge">sudo modprobe overlay permit_mounts_in_userns=1</code> is also possible,
however, highly discouraged due to <a href="https://github.com/moby/moby/issues/42302">instability</a>.</p>
      </li>
      <li>
        <p>Rootless docker requires version of <code class="highlighter-rouge">slirp4netns</code> greater than <code class="highlighter-rouge">v0.4.0</code> (when <code class="highlighter-rouge">vpnkit</code> is not installed).
Check you have this with</p>

        <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> slirp4netns <span class="nt">--version</span>
</code></pre></div>        </div>
        <p>If you do not have this download and install with <code class="highlighter-rouge">sudo apt-get install -y slirp4netns</code> or download the latest <a href="https://github.com/rootless-containers/slirp4netns/releases">release</a>.</p>
      </li>
    </ul>

  </div>
  <div id="hint-arch" class="tab-pane fade in">
    <ul>
      <li>
        <p>Installing <code class="highlighter-rouge">fuse-overlayfs</code> is recommended. Run <code class="highlighter-rouge">sudo pacman -S fuse-overlayfs</code>.</p>
      </li>
      <li>
        <p>Add <code class="highlighter-rouge">kernel.unprivileged_userns_clone=1</code> to <code class="highlighter-rouge">/etc/sysctl.conf</code> (or
<code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code></p>
      </li>
    </ul>
  </div>
  <div id="hint-opensuse-sles" class="tab-pane fade in">
    <ul>
      <li>
        <p>Installing <code class="highlighter-rouge">fuse-overlayfs</code> is recommended. Run <code class="highlighter-rouge">sudo zypper install -y fuse-overlayfs</code>.</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">sudo modprobe ip_tables iptable_mangle iptable_nat iptable_filter</code> is required.
This might be required on other distros as well depending on the configuration.</p>
      </li>
      <li>
        <p>Known to work on openSUSE 15 and SLES 15.</p>
      </li>
    </ul>
  </div>
  <div id="hint-centos8-rhel8-fedora" class="tab-pane fade in">
    <ul>
      <li>
        <p>Installing <code class="highlighter-rouge">fuse-overlayfs</code> is recommended. Run <code class="highlighter-rouge">sudo dnf install -y fuse-overlayfs</code>.</p>
      </li>
      <li>
        <p>You might need <code class="highlighter-rouge">sudo dnf install -y iptables</code>.</p>
      </li>
      <li>
        <p>Known to work on CentOS 8, RHEL 8, and Fedora 34.</p>
      </li>
    </ul>
  </div>
  <div id="hint-centos7-rhel7" class="tab-pane fade in">
    <ul>
      <li>
        <p>Add <code class="highlighter-rouge">user.max_user_namespaces=28633</code> to <code class="highlighter-rouge">/etc/sysctl.conf</code> (or 
<code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code>.</p>
      </li>
      <li>
        <p><code class="highlighter-rouge">systemctl --user</code> does not work by default. 
Run <code class="highlighter-rouge">dockerd-rootless.sh</code> directly without systemd.</p>
      </li>
    </ul>
  </div>
</div>
<p><!-- tab-content --></p>

<h2 id="known-limitations">Known limitations</h2>

<ul>
  <li>Only the following storage drivers are supported:
    <ul>
      <li><code class="highlighter-rouge">overlay2</code> (only if running with kernel 5.11 or later, or Ubuntu-flavored kernel)</li>
      <li><code class="highlighter-rouge">fuse-overlayfs</code> (only if running with kernel 4.18 or later, and <code class="highlighter-rouge">fuse-overlayfs</code> is installed)</li>
      <li><code class="highlighter-rouge">btrfs</code> (only if running with kernel 4.18 or later, or <code class="highlighter-rouge">~/.local/share/docker</code> is mounted with <code class="highlighter-rouge">user_subvol_rm_allowed</code> mount option)</li>
      <li><code class="highlighter-rouge">vfs</code></li>
    </ul>
  </li>
  <li>Cgroup is supported only when running with cgroup v2 and systemd. See <a href="#limiting-resources">Limiting resources</a>.</li>
  <li>Following features are not supported:
    <ul>
      <li>AppArmor</li>
      <li>Checkpoint</li>
      <li>Overlay network</li>
      <li>Exposing SCTP ports</li>
    </ul>
  </li>
  <li>To use the <code class="highlighter-rouge">ping</code> command, see <a href="#routing-ping-packets">Routing ping packets</a>.</li>
  <li>To expose privileged TCP/UDP ports (&lt; 1024), see <a href="#exposing-privileged-ports">Exposing privileged ports</a>.</li>
  <li><code class="highlighter-rouge">IPAddress</code> shown in <code class="highlighter-rouge">docker inspect</code> and is namespaced inside RootlessKit’s network namespace.
This means the IP address is not reachable from the host without <code class="highlighter-rouge">nsenter</code>-ing into the network namespace.</li>
  <li>Host network (<code class="highlighter-rouge">docker run --net=host</code>) is also namespaced inside RootlessKit.</li>
  <li>NFS mounts as the docker “data-root” is not supported. This limitation is not specific to rootless mode.</li>
</ul>

<h2 id="install">Install</h2>
<blockquote>
  <p><strong>Note</strong></p>

  <p>If the system-wide Docker daemon is already running, consider disabling it:
<code class="highlighter-rouge">$ sudo systemctl disable --now docker.service docker.socket</code></p>
</blockquote>

<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#install-with-packages">With packages (RPM/DEB)</a></li>
  <li><a data-toggle="tab" data-target="#install-without-packages">Without packages</a></li>
</ul>
<div class="tab-content">
  <div id="install-with-packages" class="tab-pane fade in active">
    <p>If you installed Docker 20.10 or later with <a href="/engine/install">RPM/DEB packages</a>, you should have <code class="highlighter-rouge">dockerd-rootless-setuptool.sh</code> in <code class="highlighter-rouge">/usr/bin</code>.</p>

    <p>Run <code class="highlighter-rouge">dockerd-rootless-setuptool.sh install</code> as a non-root user to set up the daemon:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> dockerd-rootless-setuptool.sh install
<span class="go">[INFO] Creating /home/testuser/.config/systemd/user/docker.service
</span><span class="c">...
</span><span class="go">[INFO] Installed docker.service successfully.
[INFO] To control docker.service, run: `systemctl --user (start|stop|restart) docker.service`
[INFO] To run docker.service on system startup, run: `sudo loginctl enable-linger testuser`

[INFO] Make sure the following environment variables are set (or add them to ~/.bashrc):

</span><span class="gp">export PATH=/usr/bin:$</span>PATH
<span class="go">export DOCKER_HOST=unix:///run/user/1000/docker.sock
</span></code></pre></div>    </div>

    <p>If <code class="highlighter-rouge">dockerd-rootless-setuptool.sh</code> is not present, you may need to install the <code class="highlighter-rouge">docker-ce-rootless-extras</code> package manually, e.g.,</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">sudo </span>apt-get install <span class="nt">-y</span> docker-ce-rootless-extras
</code></pre></div>    </div>

  </div>
  <div id="install-without-packages" class="tab-pane fade in">
    <p>If you do not have permission to run package managers like <code class="highlighter-rouge">apt-get</code> and <code class="highlighter-rouge">dnf</code>,
consider using the installation script available at <a href="https://get.docker.com/rootless" target="_blank" rel="noopener" class="_">https://get.docker.com/rootless</a>.
Since static packages are not available for <code class="highlighter-rouge">s390x</code>, hence it is not supported for <code class="highlighter-rouge">s390x</code>.</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> curl <span class="nt">-fsSL</span> https://get.docker.com/rootless | sh
<span class="c">...
</span><span class="go">[INFO] Creating /home/testuser/.config/systemd/user/docker.service
</span><span class="c">...
</span><span class="go">[INFO] Installed docker.service successfully.
[INFO] To control docker.service, run: `systemctl --user (start|stop|restart) docker.service`
[INFO] To run docker.service on system startup, run: `sudo loginctl enable-linger testuser`

[INFO] Make sure the following environment variables are set (or add them to ~/.bashrc):

</span><span class="gp">export PATH=/home/testuser/bin:$</span>PATH
<span class="go">export DOCKER_HOST=unix:///run/user/1000/docker.sock
</span></code></pre></div>    </div>

    <p>The binaries will be installed at <code class="highlighter-rouge">~/bin</code>.</p>
  </div>
</div>
<p><!-- tab-content --></p>

<p>See <a href="#troubleshooting">Troubleshooting</a> if you faced an error.</p>

<h2 id="uninstall">Uninstall</h2>

<p>To remove the systemd service of the Docker daemon, run <code class="highlighter-rouge">dockerd-rootless-setuptool.sh uninstall</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> dockerd-rootless-setuptool.sh uninstall
<span class="go">+ systemctl --user stop docker.service
+ systemctl --user disable docker.service
Removed /home/testuser/.config/systemd/user/default.target.wants/docker.service.
[INFO] Uninstalled docker.service
[INFO] This uninstallation tool does NOT remove Docker binaries and data.
[INFO] To remove data, run: `/usr/bin/rootlesskit rm -rf /home/testuser/.local/share/docker`
</span></code></pre></div></div>

<p>Unset environment variables PATH and DOCKER_HOST if you have added them to <code class="highlighter-rouge">~/.bashrc</code>.</p>

<p>To remove the data directory, run <code class="highlighter-rouge">rootlesskit rm -rf ~/.local/share/docker</code>.</p>

<p>To remove the binaries, remove <code class="highlighter-rouge">docker-ce-rootless-extras</code> package if you installed Docker with package managers.
If you installed Docker with https://get.docker.com/rootless (<a href="#install">Install without packages</a>),
remove the binary files under <code class="highlighter-rouge">~/bin</code>:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd</span> ~/bin
<span class="gp">$</span> rm <span class="nt">-f</span> containerd containerd-shim containerd-shim-runc-v2 ctr docker docker-init docker-proxy dockerd dockerd-rootless-setuptool.sh dockerd-rootless.sh rootlesskit rootlesskit-docker-proxy runc vpnkit
</code></pre></div></div>

<h2 id="usage">Usage</h2>

<h3 id="daemon">Daemon</h3>
<ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" data-target="#usage-with-systemd">With systemd (Highly recommended)</a></li>
  <li><a data-toggle="tab" data-target="#usage-without-systemd">Without systemd</a></li>
</ul>
<div class="tab-content">
  <div id="usage-with-systemd" class="tab-pane fade in active">
    <p>The systemd unit file is installed as  <code class="highlighter-rouge">~/.config/systemd/user/docker.service</code>.</p>

    <p>Use <code class="highlighter-rouge">systemctl --user</code> to manage the lifecycle of the daemon:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> systemctl <span class="nt">--user</span> start docker
</code></pre></div>    </div>

    <p>To launch the daemon on system startup, enable the systemd service and lingering:</p>

    <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> systemctl <span class="nt">--user</span> <span class="nb">enable </span>docker
<span class="gp">$</span> <span class="nb">sudo </span>loginctl enable-linger <span class="k">$(</span>whoami<span class="k">)</span>
</code></pre></div>    </div>

    <p>Starting Rootless Docker as a systemd-wide service (<code class="highlighter-rouge">/etc/systemd/system/docker.service</code>)
is not supported, even with the <code class="highlighter-rouge">User=</code> directive.</p>

  </div>
  <div id="usage-without-systemd" class="tab-pane fade in">
    <p>To run the daemon directly without systemd, you need to run <code class="highlighter-rouge">dockerd-rootless.sh</code> instead of <code class="highlighter-rouge">dockerd</code>.</p>

    <p>The following environment variables must be set:</p>
    <ul>
      <li><code class="highlighter-rouge">$HOME</code>: the home directory</li>
      <li><code class="highlighter-rouge">$XDG_RUNTIME_DIR</code>: an ephemeral directory that is only accessible by the expected user, e,g, <code class="highlighter-rouge">~/.docker/run</code>.
The directory should be removed on every host shutdown.
The directory can be on tmpfs, however, should not be under <code class="highlighter-rouge">/tmp</code>.
Locating this directory under <code class="highlighter-rouge">/tmp</code> might be vulnerable to TOCTOU attack.</li>
    </ul>

  </div>
</div>
<p><!-- tab-content --></p>

<p>Remarks about directory paths:</p>

<ul>
  <li>The socket path is set to <code class="highlighter-rouge">$XDG_RUNTIME_DIR/docker.sock</code> by default.
<code class="highlighter-rouge">$XDG_RUNTIME_DIR</code> is typically set to <code class="highlighter-rouge">/run/user/$UID</code>.</li>
  <li>The data dir is set to <code class="highlighter-rouge">~/.local/share/docker</code> by default.
The data dir should not be on NFS.</li>
  <li>The daemon config dir is set to <code class="highlighter-rouge">~/.config/docker</code> by default.
This directory is different from <code class="highlighter-rouge">~/.docker</code> that is used by the client.</li>
</ul>

<h3 id="client">Client</h3>

<p>You need to specify either the socket path or the CLI context explicitly.</p>

<p>To specify the socket path using <code class="highlighter-rouge">$DOCKER_HOST</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">export </span><span class="nv">DOCKER_HOST</span><span class="o">=</span>unix://<span class="nv">$XDG_RUNTIME_DIR</span>/docker.sock
<span class="gp">$</span> docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:80 nginx
</code></pre></div></div>

<p>To specify the CLI context using <code class="highlighter-rouge">docker context</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker context use rootless
<span class="go">rootless
Current context is now "rootless"
</span><span class="gp">$</span> docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:80 nginx
</code></pre></div></div>

<h2 id="best-practices">Best practices</h2>

<h3 id="rootless-docker-in-docker">Rootless Docker in Docker</h3>

<p>To run Rootless Docker inside “rootful” Docker, use the <code class="highlighter-rouge">docker:&lt;version&gt;-dind-rootless</code>
image instead of <code class="highlighter-rouge">docker:&lt;version&gt;-dind</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker run <span class="nt">-d</span> <span class="nt">--name</span> dind-rootless <span class="nt">--privileged</span> docker:20.10-dind-rootless
</code></pre></div></div>

<p>The <code class="highlighter-rouge">docker:&lt;version&gt;-dind-rootless</code> image runs as a non-root user (UID 1000).
However, <code class="highlighter-rouge">--privileged</code> is required for disabling seccomp, AppArmor, and mount
masks.</p>

<h3 id="expose-docker-api-socket-through-tcp">Expose Docker API socket through TCP</h3>

<p>To expose the Docker API socket through TCP, you need to launch <code class="highlighter-rouge">dockerd-rootless.sh</code>
with <code class="highlighter-rouge">DOCKERD_ROOTLESS_ROOTLESSKIT_FLAGS="-p 0.0.0.0:2376:2376/tcp"</code>.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nv">DOCKERD_ROOTLESS_ROOTLESSKIT_FLAGS</span><span class="o">=</span><span class="s2">"-p 0.0.0.0:2376:2376/tcp"</span> <span class="se">\</span>
  dockerd-rootless.sh <span class="se">\</span>
  <span class="nt">-H</span> tcp://0.0.0.0:2376 <span class="se">\</span>
  <span class="nt">--tlsverify</span> <span class="nt">--tlscacert</span><span class="o">=</span>ca.pem <span class="nt">--tlscert</span><span class="o">=</span>cert.pem <span class="nt">--tlskey</span><span class="o">=</span>key.pem
</code></pre></div></div>

<h3 id="expose-docker-api-socket-through-ssh">Expose Docker API socket through SSH</h3>

<p>To expose the Docker API socket through SSH, you need to make sure <code class="highlighter-rouge">$DOCKER_HOST</code>
is set on the remote host.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> ssh <span class="nt">-l</span> &lt;REMOTEUSER&gt; &lt;REMOTEHOST&gt; <span class="s1">'echo $DOCKER_HOST'</span>
<span class="go">unix:///run/user/1001/docker.sock
</span><span class="gp">$</span> docker <span class="nt">-H</span> ssh://&lt;REMOTEUSER&gt;@&lt;REMOTEHOST&gt; run ...
</code></pre></div></div>

<h3 id="routing-ping-packets">Routing ping packets</h3>

<p>On some distributions, <code class="highlighter-rouge">ping</code> does not work by default.</p>

<p>Add <code class="highlighter-rouge">net.ipv4.ping_group_range = 0   2147483647</code> to <code class="highlighter-rouge">/etc/sysctl.conf</code> (or
<code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code> to allow using <code class="highlighter-rouge">ping</code>.</p>

<h3 id="exposing-privileged-ports">Exposing privileged ports</h3>

<p>To expose privileged ports (&lt; 1024), set <code class="highlighter-rouge">CAP_NET_BIND_SERVICE</code> on <code class="highlighter-rouge">rootlesskit</code> binary.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">sudo </span>setcap <span class="nv">cap_net_bind_service</span><span class="o">=</span>ep <span class="nv">$HOME</span>/bin/rootlesskit
</code></pre></div></div>

<p>Or add <code class="highlighter-rouge">net.ipv4.ip_unprivileged_port_start=0</code> to <code class="highlighter-rouge">/etc/sysctl.conf</code> (or
<code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code>.</p>

<h3 id="limiting-resources">Limiting resources</h3>
<p>Limiting resources with cgroup-related <code class="highlighter-rouge">docker run</code> flags such as <code class="highlighter-rouge">--cpus</code>, <code class="highlighter-rouge">--memory</code>, <code class="highlighter-rouge">--pids-limit</code>
is supported only when running with cgroup v2 and systemd.
See <a href="/config/containers/runmetrics/">Changing cgroup version</a> to enable cgroup v2.</p>

<p>If <code class="highlighter-rouge">docker info</code> shows <code class="highlighter-rouge">none</code> as <code class="highlighter-rouge">Cgroup Driver</code>, the conditions are not satisfied.
When these conditions are not satisfied, rootless mode ignores the cgroup-related <code class="highlighter-rouge">docker run</code> flags.
See <a href="#limiting-resources-without-cgroup">Limiting resources without cgroup</a> for workarounds.</p>

<p>If <code class="highlighter-rouge">docker info</code> shows <code class="highlighter-rouge">systemd</code> as <code class="highlighter-rouge">Cgroup Driver</code>, the conditions are satisfied.
However, typically, only <code class="highlighter-rouge">memory</code> and <code class="highlighter-rouge">pids</code> controllers are delegated to non-root users by default.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cat</span> /sys/fs/cgroup/user.slice/user-<span class="k">$(</span>id <span class="nt">-u</span><span class="k">)</span>.slice/user@<span class="k">$(</span>id <span class="nt">-u</span><span class="k">)</span>.service/cgroup.controllers
<span class="go">memory pids
</span></code></pre></div></div>

<p>To allow delegation of all controllers, you need to change the systemd configuration as follows:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span> mkdir <span class="nt">-p</span> /etc/systemd/system/user@.service.d
<span class="gp">#</span> <span class="nb">cat</span> <span class="o">&gt;</span> /etc/systemd/system/user@.service.d/delegate.conf <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
</span><span class="go">[Service]
Delegate=cpu cpuset io memory pids
EOF
</span><span class="gp">#</span> systemctl daemon-reload
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong></p>

  <p>Delegating <code class="highlighter-rouge">cpuset</code> requires systemd 244 or later.</p>
</blockquote>

<h4 id="limiting-resources-without-cgroup">Limiting resources without cgroup</h4>
<p>Even when cgroup is not available, you can still use the traditional <code class="highlighter-rouge">ulimit</code> and <a href="https://github.com/opsengine/cpulimit"><code class="highlighter-rouge">cpulimit</code></a>,
though they work in process-granularity rather than in container-granularity,
and can be arbitrarily disabled by the container process.</p>

<p>For example:</p>

<ul>
  <li>To limit CPU usage to 0.5 cores (similar to <code class="highlighter-rouge">docker run --cpus 0.5</code>):
<code class="highlighter-rouge">docker run &lt;IMAGE&gt; cpulimit --limit=50 --include-children &lt;COMMAND&gt;</code></li>
  <li>
    <p>To limit max VSZ to 64MiB (similar to <code class="highlighter-rouge">docker run --memory 64m</code>):
<code class="highlighter-rouge">docker run &lt;IMAGE&gt; sh -c "ulimit -v 65536; &lt;COMMAND&gt;"</code></p>
  </li>
  <li>To limit max number of processes to 100 per namespaced UID 2000
(similar to <code class="highlighter-rouge">docker run --pids-limit=100</code>):
<code class="highlighter-rouge">docker run --user 2000 --ulimit nproc=100 &lt;IMAGE&gt; &lt;COMMAND&gt;</code></li>
</ul>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="errors-when-starting-the-docker-daemon">Errors when starting the Docker daemon</h3>

<p><strong>[rootlesskit:parent] error: failed to start the child: fork/exec /proc/self/exe: operation not permitted</strong></p>

<p>This error occurs mostly when the value of <code class="highlighter-rouge">/proc/sys/kernel/unprivileged_userns_clone </code> is set to 0:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cat</span> /proc/sys/kernel/unprivileged_userns_clone
<span class="go">0
</span></code></pre></div></div>

<p>To fix this issue, add  <code class="highlighter-rouge">kernel.unprivileged_userns_clone=1</code> to
<code class="highlighter-rouge">/etc/sysctl.conf</code> (or <code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code>.</p>

<p><strong>[rootlesskit:parent] error: failed to start the child: fork/exec /proc/self/exe: no space left on device</strong></p>

<p>This error occurs mostly when the value of <code class="highlighter-rouge">/proc/sys/user/max_user_namespaces</code> is too small:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cat</span> /proc/sys/user/max_user_namespaces
<span class="go">0
</span></code></pre></div></div>

<p>To fix this issue, add  <code class="highlighter-rouge">user.max_user_namespaces=28633</code> to
<code class="highlighter-rouge">/etc/sysctl.conf</code> (or <code class="highlighter-rouge">/etc/sysctl.d</code>) and run <code class="highlighter-rouge">sudo sysctl --system</code>.</p>

<p><strong>[rootlesskit:parent] error: failed to setup UID/GID map: failed to compute uid/gid map: No subuid ranges found for user 1001 (“testuser”)</strong></p>

<p>This error occurs when <code class="highlighter-rouge">/etc/subuid</code> and <code class="highlighter-rouge">/etc/subgid</code> are not configured. See <a href="#prerequisites">Prerequisites</a>.</p>

<p><strong>could not get XDG_RUNTIME_DIR</strong></p>

<p>This error occurs when <code class="highlighter-rouge">$XDG_RUNTIME_DIR</code> is not set.</p>

<p>On a non-systemd host, you need to create a directory and then set the path:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">export </span><span class="nv">XDG_RUNTIME_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/.docker/xrd
<span class="gp">$</span> rm <span class="nt">-rf</span> <span class="nv">$XDG_RUNTIME_DIR</span>
<span class="gp">$</span> mkdir <span class="nt">-p</span> <span class="nv">$XDG_RUNTIME_DIR</span>
<span class="gp">$</span> dockerd-rootless.sh
</code></pre></div></div>

<blockquote>
  <p><strong>Note</strong>:
You must remove the directory every time you log out.</p>
</blockquote>

<p>On a systemd host, log into the host using <code class="highlighter-rouge">pam_systemd</code> (see below).
The value is automatically set to <code class="highlighter-rouge">/run/user/$UID</code> and cleaned up on every logout.</p>

<p><strong><code class="highlighter-rouge">systemctl --user</code> fails with “Failed to connect to bus: No such file or directory”</strong></p>

<p>This error occurs mostly when you switch from the root user to an non-root user with <code class="highlighter-rouge">sudo</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span> <span class="nb">sudo</span> <span class="nt">-iu</span> testuser
<span class="gp">$</span> systemctl <span class="nt">--user</span> start docker
<span class="go">Failed to connect to bus: No such file or directory
</span></code></pre></div></div>

<p>Instead of <code class="highlighter-rouge">sudo -iu &lt;USERNAME&gt;</code>, you need to log in using <code class="highlighter-rouge">pam_systemd</code>. For example:</p>

<ul>
  <li>Log in through the graphic console</li>
  <li><code class="highlighter-rouge">ssh &lt;USERNAME&gt;@localhost</code></li>
  <li><code class="highlighter-rouge">machinectl shell &lt;USERNAME&gt;@</code></li>
</ul>

<p><strong>The daemon does not start up automatically</strong></p>

<p>You need <code class="highlighter-rouge">sudo loginctl enable-linger $(whoami)</code> to enable the daemon to start
up automatically. See <a href="#usage">Usage</a>.</p>

<p><strong>iptables failed: iptables -t nat -N DOCKER: Fatal: can’t open lock file /run/xtables.lock: Permission denied</strong></p>

<p>This error may happen with an older version of Docker when SELinux is enabled on the host.</p>

<p>The issue has been fixed in Docker 20.10.8.
A known workaround for older version of Docker is to run the following commands to disable SELinux for <code class="highlighter-rouge">iptables</code>:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">sudo </span>dnf install <span class="nt">-y</span> policycoreutils-python-utils <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>semanage permissive <span class="nt">-a</span> iptables_t
</code></pre></div></div>

<h3 id="docker-pull-errors"><code class="highlighter-rouge">docker pull</code> errors</h3>

<p><strong>docker: failed to register layer: Error processing tar file(exit status 1): lchown &lt;FILE&gt;: invalid argument</strong></p>

<p>This error occurs when the number of available entries in <code class="highlighter-rouge">/etc/subuid</code> or
<code class="highlighter-rouge">/etc/subgid</code> is not sufficient. The number of entries required vary across
images. However, 65,536 entries are sufficient for most images. See
<a href="#prerequisites">Prerequisites</a>.</p>

<p><strong>docker: failed to register layer: ApplyLayer exit status 1 stdout:  stderr: lchown &lt;FILE&gt;: operation not permitted</strong></p>

<p>This error occurs mostly when <code class="highlighter-rouge">~/.local/share/docker</code> is located on NFS.</p>

<p>A workaround is to specify non-NFS <code class="highlighter-rouge">data-root</code> directory in <code class="highlighter-rouge">~/.config/docker/daemon.json</code> as follows:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="s2">"data-root"</span><span class="p">:</span><span class="s2">"/somewhere-out-of-nfs"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="docker-run-errors"><code class="highlighter-rouge">docker run</code> errors</h3>

<p><strong>docker: Error response from daemon: OCI runtime create failed: ...: read unix @-&gt;/run/systemd/private: read: connection reset by peer: unknown.</strong></p>

<p>This error occurs on cgroup v2 hosts mostly when the dbus daemon is not running for the user.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> systemctl <span class="nt">--user</span> is-active dbus
<span class="go">inactive

</span><span class="gp">$</span> docker run hello-world
<span class="go">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: process_linux.go:385: applying cgroup configuration for process caused: error while starting unit "docker
-931c15729b5a968ce803784d04c7421f791d87e5ca1891f34387bb9f694c488e.scope" with properties [{Name:Description Value:"libcontainer container 931c15729b5a968ce803784d04c7421f791d87e5ca1891f34387bb9f694c488e"} {Name:Slice Value:"use
r.slice"} {Name:PIDs Value:@au [4529]} {Name:Delegate Value:true} {Name:MemoryAccounting Value:true} {Name:CPUAccounting Value:true} {Name:IOAccounting Value:true} {Name:TasksAccounting Value:true} {Name:DefaultDependencies Val
</span><span class="gp">ue:false}]: read unix @-&gt;</span>/run/systemd/private: <span class="nb">read</span>: connection reset by peer: unknown.
</code></pre></div></div>

<p>To fix the issue, run <code class="highlighter-rouge">sudo apt-get install -y dbus-user-session</code> or <code class="highlighter-rouge">sudo dnf install -y dbus-daemon</code>, and then relogin.</p>

<p>If the error still occurs, try running <code class="highlighter-rouge">systemctl --user enable --now dbus</code> (without sudo).</p>

<p><strong><code class="highlighter-rouge">--cpus</code>, <code class="highlighter-rouge">--memory</code>, and <code class="highlighter-rouge">--pids-limit</code> are ignored</strong></p>

<p>This is an expected behavior on cgroup v1 mode.
To use these flags, the host needs to be configured for enabling cgroup v2.
For more information, see <a href="#limiting-resources">Limiting resources</a>.</p>

<h3 id="networking-errors">Networking errors</h3>

<p><strong><code class="highlighter-rouge">docker run -p</code> fails with <code class="highlighter-rouge">cannot expose privileged port</code></strong></p>

<p><code class="highlighter-rouge">docker run -p</code> fails with this error when a privileged port (&lt; 1024) is specified as the host port.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker run <span class="nt">-p</span> 80:80 nginx:alpine
<span class="gp">docker: Error response from daemon: driver failed programming external connectivity on endpoint focused_swanson (9e2e139a9d8fc92b37c36edfa6214a6e986fa2028c0cc359812f685173fa6df7): Error starting userland proxy: error while calling PortManager.AddPort(): cannot expose privileged port 80, you might need to add "net.ipv4.ip_unprivileged_port_start=0" (currently 1024) to /etc/sysctl.conf, or set CAP_NET_BIND_SERVICE on rootlesskit binary, or choose a larger port number (&gt;</span><span class="o">=</span> 1024<span class="o">)</span>: listen tcp 0.0.0.0:80: <span class="nb">bind</span>: permission denied.
</code></pre></div></div>

<p>When you experience this error, consider using an unprivileged port instead. For example, 8080 instead of 80.</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> docker run <span class="nt">-p</span> 8080:80 nginx:alpine
</code></pre></div></div>

<p>To allow exposing privileged ports, see <a href="#exposing-privileged-ports">Exposing privileged ports</a>.</p>

<p><strong>ping doesn’t work</strong></p>

<p>Ping does not work when <code class="highlighter-rouge">/proc/sys/net/ipv4/ping_group_range</code> is set to <code class="highlighter-rouge">1 0</code>:</p>

<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cat</span> /proc/sys/net/ipv4/ping_group_range
<span class="go">1       0
</span></code></pre></div></div>

<p>For details, see <a href="#routing-ping-packets">Routing ping packets</a>.</p>

<p><strong><code class="highlighter-rouge">IPAddress</code> shown in <code class="highlighter-rouge">docker inspect</code> is unreachable</strong></p>

<p>This is an expected behavior, as the daemon is namespaced inside RootlessKit’s
network namespace. Use <code class="highlighter-rouge">docker run -p</code> instead.</p>

<p><strong><code class="highlighter-rouge">--net=host</code> doesn’t listen ports on the host network namespace</strong></p>

<p>This is an expected behavior, as the daemon is namespaced inside RootlessKit’s
network namespace. Use <code class="highlighter-rouge">docker run -p</code> instead.</p>

<p><strong>Network is slow</strong></p>

<p>Docker with rootless mode uses <a href="https://github.com/rootless-containers/slirp4netns">slirp4netns</a> as the default network stack if slirp4netns v0.4.0 or later is installed.
If slirp4netns is not installed, Docker falls back to <a href="https://github.com/moby/vpnkit">VPNKit</a>.</p>

<p>Installing slirp4netns may improve the network throughput.
See <a href="https://github.com/rootless-containers/rootlesskit/tree/v0.13.0#network-drivers">RootlessKit documentation</a> for the benchmark result.</p>

<p>Also, changing MTU value may improve the throughput.
The MTU value can be specified by creating <code class="highlighter-rouge">~/.config/systemd/user/docker.service.d/override.conf</code> with the following content:</p>

<pre><code class="language-systemd">[Service]
Environment="DOCKERD_ROOTLESS_ROOTLESSKIT_MTU=&lt;INTEGER&gt;"
</code></pre>

<p>And then restart the daemon:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> systemctl <span class="nt">--user</span> daemon-reload
<span class="gp">$</span> systemctl <span class="nt">--user</span> restart docker
</code></pre></div></div>

<p><strong><code class="highlighter-rouge">docker run -p</code> does not propagate source IP addresses</strong></p>

<p>This is because Docker with rootless mode uses RootlessKit’s builtin port driver by default.</p>

<p>The source IP addresses can be propagated by creating <code class="highlighter-rouge">~/.config/systemd/user/docker.service.d/override.conf</code> with the following content:</p>

<pre><code class="language-systemd">[Service]
Environment="DOCKERD_ROOTLESS_ROOTLESSKIT_PORT_DRIVER=slirp4netns"
</code></pre>

<p>And then restart the daemon:</p>
<div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> systemctl <span class="nt">--user</span> daemon-reload
<span class="gp">$</span> systemctl <span class="nt">--user</span> restart docker
</code></pre></div></div>

<p>Note that this configuration decreases throughput.
See <a href="https://github.com/rootless-containers/rootlesskit/tree/v0.13.0#port-drivers">RootlessKit documentation</a> for the benchmark result.</p>

<h3 id="tips-for-debugging">Tips for debugging</h3>
<p><strong>Entering into <code class="highlighter-rouge">dockerd</code> namespaces</strong></p>

<p>The <code class="highlighter-rouge">dockerd-rootless.sh</code> script executes <code class="highlighter-rouge">dockerd</code> in its own user, mount, and network namespaces.</p>

<p>For debugging, you can enter the namespaces by running
<code class="highlighter-rouge">nsenter -U --preserve-credentials -n -m -t $(cat $XDG_RUNTIME_DIR/docker.pid)</code>.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/search/?q=security">security</a>, <a href="/search/?q=namespaces">namespaces</a>, <a href="/search/?q=rootless">rootless</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/docker/docker.github.io/edit/master/engine/security/rootless.md"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [engine/security/rootless.md](https://docs.docker.com/engine/security/rootless/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#how-it-works" class="nomunge">How it works</a></li>
  <li><a href="#prerequisites" class="nomunge">Prerequisites</a>
    <ul>
      <li><a href="#distribution-specific-hint" class="nomunge">Distribution-specific hint</a></li>
    </ul>
  </li>
  <li><a href="#known-limitations" class="nomunge">Known limitations</a></li>
  <li><a href="#install" class="nomunge">Install</a></li>
  <li><a href="#uninstall" class="nomunge">Uninstall</a></li>
  <li><a href="#usage" class="nomunge">Usage</a>
    <ul>
      <li><a href="#daemon" class="nomunge">Daemon</a></li>
      <li><a href="#client" class="nomunge">Client</a></li>
    </ul>
  </li>
  <li><a href="#best-practices" class="nomunge">Best practices</a>
    <ul>
      <li><a href="#rootless-docker-in-docker" class="nomunge">Rootless Docker in Docker</a></li>
      <li><a href="#expose-docker-api-socket-through-tcp" class="nomunge">Expose Docker API socket through TCP</a></li>
      <li><a href="#expose-docker-api-socket-through-ssh" class="nomunge">Expose Docker API socket through SSH</a></li>
      <li><a href="#routing-ping-packets" class="nomunge">Routing ping packets</a></li>
      <li><a href="#exposing-privileged-ports" class="nomunge">Exposing privileged ports</a></li>
      <li><a href="#limiting-resources" class="nomunge">Limiting resources</a></li>
    </ul>
  </li>
  <li><a href="#troubleshooting" class="nomunge">Troubleshooting</a>
    <ul>
      <li><a href="#errors-when-starting-the-docker-daemon" class="nomunge">Errors when starting the Docker daemon</a></li>
      <li><a href="#docker-pull-errors" class="nomunge">docker pull errors</a></li>
      <li><a href="#docker-run-errors" class="nomunge">docker run errors</a></li>
      <li><a href="#networking-errors" class="nomunge">Networking errors</a></li>
      <li><a href="#tips-for-debugging" class="nomunge">Tips for debugging</a></li>
    </ul>
  </li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker?</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container?</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker Product Roadmap</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQs</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker Verified Publisher Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/engine/security/rootless/";</script><script>
    let PDRTJS_settings_8453675 = {
        "id": "8453675",
        "unique_id": "engine/security/rootless.md",
        "title": "Run the Docker daemon as a non-root user (Rootless mode)",
        "font_family": "Open Sans, sans serif",
        "font_color": "b9c2cc",
        "font_align": "center",
        "permalink": "https://github.com/docker/docker.github.io/blob/master/engine/security/rootless.md"
    };
    (function (d, c, j) {
        if (!document.getElementById(j)) {
            let pd=d.createElement(c),s;pd.id=j;pd.src='https://polldaddy.com/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd, s);
        }
    }(document, 'script', 'pd-rating-js'));
</script></body>
</html>
