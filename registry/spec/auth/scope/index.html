<!-- Page generated 2021-11-17 12:16:07 +0000-->
<!DOCTYPE html>
<html lang="en"><head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-WL2QLG5');</script>
<title>Token Scope Documentation | Docker Documentation</title>
  <meta name="description" content="Describes the scope and access fields used for registry authorization tokens" />
  <meta name="keywords" content="registry, on-prem, images, tags, repository, distribution, advanced, access, scope">
  <link rel="canonical" href="https://docs.docker.com/registry/spec/auth/scope/" />

  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <link rel="apple-touch-icon" type="image/x-icon" href="/favicons/docs@2x.ico" sizes="129x128">
  <meta name="msapplication-TileImage" content="/favicons/docs@2x.ico">
  <meta property="og:image" content="/favicons/docs@2x.ico"/>
  <meta name="theme-color" content="#2496ed" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- hide elements that are only shown without JavaScript enabled -->
  <script>document.documentElement.classList.add('js')</script>
  <style>html.js .no-js { display: none !important; }</style><script defer src="/js/theme-switcher.js"></script>
  <script defer src="/js/anchorlinks.js"></script>
  <script defer src="/js/jquery.js"></script>
  <script defer src="/js/bootstrap.min.js"></script>
  <script defer src="/js/docs.js"></script><script defer src="/js/search.js"></script><link rel="preload" as="font" href="https://fonts.gstatic.com/s/opensans/v18/mem8YaGs126MiZpBA-UFVZ0bf8pkAg.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Book.woff2"    type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/geomanist/hinted-Geomanist-Regular.woff2" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/glyphicons-halflings-regular.woff2"       type="font/woff2" crossorigin="anonymous">
  <link rel="preload" as="font" href="/fonts/fontawesome-webfont.woff2?v=4.7.0"        type="font/woff2" crossorigin="anonymous">

  <link rel="stylesheet" href="/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/style.css" id="pagestyle">

  <!-- SEO stuff -->
  <meta name="twitter:title" itemprop="title name" content="Token Scope Documentation"/>
  <meta name="twitter:description" property="og:description" itemprop="description" content="" />
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:domain" content="docs.docker.com"/>
  <meta name="twitter:site" content="@docker_docs"/>
  <meta name="twitter:url" content="https://twitter.com/docker_docs"/>
  <meta name="twitter:image:src" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta name="twitter:image:alt" content="Docker Documentation"/>
  <meta property="og:title" content="Token Scope Documentation" />
  <meta property="og:description" content="Describes the scope and access fields used for registry authorization tokens" />
  <meta property="og:type" content="website"/>
  <meta property="og:updated_time" itemprop="dateUpdated" content="2021-11-17T12:16:07+00:00"/>
  <meta property="og:image" itemprop="image primaryImageOfPage" content="https://docs.docker.com/images/docs@2x.png"/>
  <meta property="og:locale" content="en_US" />
  <meta property="og:url" content="https://docs.docker.com/registry/spec/auth/scope/" />
  <meta property="og:site_name" content="Docker Documentation" />
  <meta property="article:published_time" itemprop="datePublished" content="2021-11-17T12:16:07+00:00"/>
  <script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"Token Scope Documentation","description":"Describes the scope and access fields used for registry authorization tokens","url":"https://docs.docker.com/registry/spec/auth/scope/"}</script>
  <!-- END SEO STUFF -->
</head>
<body class="colums">
    <header>
        <nav class="nav-secondary navbar navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <a href="/">
                <img class="logo" src="/images/docker-docs-logo.svg" alt="Docker Docs" title="Docker Docs" width="160" height="28" />
            </a>
        </div>
        <div class="navbar-collapse" aria-expanded="false" style="height: 1px;">
            <div class="logo-mobile">
    <a href="/">
        <img src="/images/docker-icon.svg" alt="Docker Docs" title="Docker Docs" width="30" height="30" />
    </a>
</div>
<div class="search-form" id="search-div">
    <form class="search-form form-inline" id="searchForm" action="/search/" method="get">
        <label for="st-search-input" class="sr-only">Search</label>
        <input class="search-field form-control ds-input" id="st-search-input" name="q" placeholder="Search the docs" type="search" autocomplete="off" spellcheck="false" dir="auto" style="position: relative; vertical-align: top;">
        <div id="autocompleteResults"></div>
        <!-- <button type="submit" class="search-submit btn btn-default">Search</button> -->
    </form>
</div>
<div class="sidebar-toggle">
    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
    </button>
</div>
<div class="nav-container hidden-sm hidden-xs">
    <div>
        <ul class="nav navbar-nav"><li><a href="/" id="home">Home</a></li><li><a href="/get-started/overview/" id="guides">Guides</a></li><li><a href="/desktop/" id="manuals">Manuals</a></li><li><a href="/reference/" id="reference">Reference</a></li><li><a href="/samples/" id="samples">Samples</a></li></ul>
    </div>
    <div class="ctrl-right">
        <a href="javascript:void(0)" id="menu-toggle" aria-label="Current page's menu toggle"><i class="fa fa-indent" aria-hidden="true"></i></a>
    </div>
</div>
<div class="row hidden-sm hidden-xs">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><a href="/" title="Docker docs homepage"><i class="fa fa-home"></i></a></li>
            <li><a href="/reference/">Reference</a></li><li><a>Drivers and specifications</a></li><li><a href="/registry/spec/auth/">Registry token authorization</a></li><li><a href="/registry/spec/auth/scope/">Token scope documentation</a></li></ol>
    </nav>
</div></div>
    </div>
</nav>

    </header>
    <div class="wrapper right-open">
        <div class="container-fluid">
            <div class="row">
                <div class="col-body">
                    <main class="col-content content">
                        <section class="section"><h1>Token Scope Documentation</h1><p><em class="reading-time">Estimated reading time: 6 minutes</em></p><h1 id="docker-registry-token-scope-and-access">Docker Registry Token Scope and Access</h1>

<p>Tokens used by the registry are always restricted what resources they may
be used to access, where those resources may be accessed, and what actions
may be done on those resources. Tokens always have the context of a user which
the token was originally created for. This document describes how these
restrictions are represented and enforced by the authorization server and
resource providers.</p>

<h2 id="scope-components">Scope Components</h2>

<h3 id="subject-authenticated-user">Subject (Authenticated User)</h3>

<p>The subject represents the user for which a token is valid. Any actions
performed using an access token should be considered on behalf of the subject.
This is included in the <code class="highlighter-rouge">sub</code> field of access token JWT. A refresh token should
be limited to a single subject and only be able to give out access tokens for
that subject.</p>

<h3 id="audience-resource-provider">Audience (Resource Provider)</h3>

<p>The audience represents a resource provider which is intended to be able to
perform the actions specified in the access token. Any resource provider which
does not match the audience should not use that access token. The audience is
included in the <code class="highlighter-rouge">aud</code> field of the access token JWT. A refresh token should be
limited to a single audience and only be able to give out access tokens for that
audience.</p>

<h3 id="resource-type">Resource Type</h3>

<p>The resource type represents the type of resource which the resource name is
intended to represent. This type may be specific to a resource provider but must
be understood by the authorization server in order to validate the subject
is authorized for a specific resource.</p>

<h4 id="resource-class">Resource Class</h4>

<p>The resource type might have a resource class which further classifies the
the resource name within the resource type. A class is not required and
is specific to the resource type.</p>

<h4 id="example-resource-types">Example Resource Types</h4>

<ul>
  <li><code class="highlighter-rouge">repository</code> - represents a single repository within a registry. A
repository may represent many manifest or content blobs, but the resource type
is considered the collections of those items. Actions which may be performed on
a <code class="highlighter-rouge">repository</code> are <code class="highlighter-rouge">pull</code> for accessing the collection and <code class="highlighter-rouge">push</code> for adding to
it. By default the <code class="highlighter-rouge">repository</code> type has the class of <code class="highlighter-rouge">image</code>.</li>
  <li><code class="highlighter-rouge">repository(plugin)</code> - represents a single repository of plugins within a
registry. A plugin repository has the same content and actions as a repository.</li>
  <li><code class="highlighter-rouge">registry</code> - represents the entire registry. Used for administrative actions
or lookup operations that span an entire registry.</li>
</ul>

<h3 id="resource-name">Resource Name</h3>

<p>The resource name represent the name which identifies a resource for a resource
provider. A resource is identified by this name and the provided resource type.
An example of a resource name would be the name component of an image tag, such
as “samalba/myapp” or “hostname/samalba/myapp”.</p>

<h3 id="resource-actions">Resource Actions</h3>

<p>The resource actions define the actions which the access token allows to be
performed on the identified resource. These actions are type specific but will
normally have actions identifying read and write access on the resource. Example
for the <code class="highlighter-rouge">repository</code> type are <code class="highlighter-rouge">pull</code> for read access and <code class="highlighter-rouge">push</code> for write
access.</p>

<h2 id="authorization-server-use">Authorization Server Use</h2>

<p>Each access token request may include a scope and an audience. The subject is
always derived from the passed in credentials or refresh token. When using
a refresh token the passed in audience must match the audience defined for
the refresh token. The audience (resource provider) is provided using the
<code class="highlighter-rouge">service</code> field. Multiple resource scopes may be provided using multiple <code class="highlighter-rouge">scope</code>
fields on the <code class="highlighter-rouge">GET</code> request. The <code class="highlighter-rouge">POST</code> request only takes in a single
<code class="highlighter-rouge">scope</code> field but may use a space to separate a list of multiple resource
scopes.</p>

<h3 id="resource-scope-grammar">Resource Scope Grammar</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scope                   := resourcescope [ ' ' resourcescope ]*
resourcescope           := resourcetype  ":" resourcename  ":" action [ ',' action ]*
resourcetype            := resourcetypevalue [ '(' resourcetypevalue ')' ]
resourcetypevalue       := /[a-z0-9]+/
resourcename            := [ hostname '/' ] component [ '/' component ]*
hostname                := hostcomponent ['.' hostcomponent]* [':' port-number]
hostcomponent           := /([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])/
port-number             := /[0-9]+/
action                  := /[a-z]*/
component               := alpha-numeric [ separator alpha-numeric ]*
alpha-numeric           := /[a-z0-9]+/
separator               := /[_.]|__|[-]*/
</code></pre></div></div>
<p>Full reference grammar is defined
<a href="https://godoc.org/github.com/docker/distribution/reference">here</a>. Currently
the scope name grammar is a subset of the reference grammar.</p>

<blockquote>
  <p><strong>NOTE:</strong> that the <code class="highlighter-rouge">resourcename</code> may contain one <code class="highlighter-rouge">:</code> due to a possible port
number in the hostname component of the <code class="highlighter-rouge">resourcename</code>, so a naive
implementation that interprets the first three <code class="highlighter-rouge">:</code>-delimited tokens of a
<code class="highlighter-rouge">scope</code> to be the <code class="highlighter-rouge">resourcetype</code>, <code class="highlighter-rouge">resourcename</code>, and a list of <code class="highlighter-rouge">action</code>
would be insufficient.</p>
</blockquote>

<h2 id="resource-provider-use">Resource Provider Use</h2>

<p>Once a resource provider has verified the authenticity of the scope through
JWT access token verification, the resource provider must ensure that scope
satisfies the request. The resource provider should match the given audience
according to name or URI the resource provider uses to identify itself. Any
denial based on subject is not defined here and is up to resource provider, the
subject is mainly provided for audit logs and any other user-specific rules
which may need to be provided but are not defined by the authorization server.</p>

<p>The resource provider must ensure that ANY resource being accessed as the
result of a request has the appropriate access scope. Both the resource type
and resource name must match the accessed resource and an appropriate action
scope must be included.</p>

<p>When appropriate authorization is not provided either due to lack of scope
or missing token, the resource provider to return a <code class="highlighter-rouge">WWW-AUTHENTICATE</code> HTTP
header with the <code class="highlighter-rouge">realm</code> as the authorization server, the <code class="highlighter-rouge">service</code> as the
expected audience identifying string, and a <code class="highlighter-rouge">scope</code> field for each required
resource scope to complete the request.</p>

<h2 id="jwt-access-tokens">JWT Access Tokens</h2>

<p>Each JWT access token may only have a single subject and audience but multiple
resource scopes. The subject and audience are put into standard JWT fields
<code class="highlighter-rouge">sub</code> and <code class="highlighter-rouge">aud</code>. The resource scope is put into the <code class="highlighter-rouge">access</code> field. The
structure of the access field can be seen in the
<a href="/registry/spec/auth/jwt/">jwt documentation</a>.</p>

<h2 id="refresh-tokens">Refresh Tokens</h2>

<p>A refresh token must be defined for a single subject and audience. Further
restricting scope to specific type, name, and actions combinations should be
done by fetching an access token using the refresh token. Since the refresh
token is not scoped to specific resources for an audience, extra care should
be taken to only use the refresh token to negotiate new access tokens directly
with the authorization server, and never with a resource provider.</p>
<span class="glyphicon glyphicon-tags" style="padding-right: 10px"></span><span style="vertical-align: 2px"><a href="/search/?q=registry">registry</a>, <a href="/search/?q=on-prem">on-prem</a>, <a href="/search/?q=images">images</a>, <a href="/search/?q=tags">tags</a>, <a href="/search/?q=repository">repository</a>, <a href="/search/?q=distribution">distribution</a>, <a href="/search/?q=advanced">advanced</a>, <a href="/search/?q=access">access</a>, <a href="/search/?q=scope">scope</a></span><div class="ratings-div"><div id="pd_rating_holder_8453675"></div></div></section>
                    </main>
                    <nav class="col-nav">
                        <div id="sidebar-nav" class="sidebar hidden-sm hidden-xs">
                            <div id="navbar" class="nav-sidebar">
                                <ul class="nav hidden-md hidden-lg"></ul>
                                <ul class="nav" id="jsTOCLeftNav"></ul>
                            </div>
                        </div>
                    </nav>
                    <div class="col-toc">
                        <div class="sidebar hidden-xs hidden-sm">
                            <div class="toc-nav">
                                <div class="feedback-links">
                                    <ul><li><a href="https://github.com/docker/distribution/tree/master/docs/spec"><i class="fa fa-pencil-square-o" aria-hidden="true"></i> Edit this page</a></li><li><a href="https://github.com/docker/docker.github.io/issues/new?body=File: [registry/spec/auth/scope.md](https://docs.docker.com/registry/spec/auth/scope/)" class="nomunge"><i class="fa fa-check" aria-hidden="true"></i> Request docs changes</a></li>
                                        <li><div class="toggle-mode">
  <div class="icon">
      <i class="fa fa-sun-o" aria-hidden="true"></i>
  </div>
  <div class="toggle-switch">
      <label class="switch">
          <input type="checkbox" id="switch-style">
          <span class="slider round"></span>
      </label>
  </div>
  <div class="icon">
      <i class="fa fa-moon-o" aria-hidden="true"></i>
  </div>
</div>
</li>
                                    </ul>
                                </div><div id="side-toc-title">On this page:</div>
<ul id="my_toc" class="inline_toc">
  <li><a href="#scope-components" class="nomunge">Scope Components</a>
    <ul>
      <li><a href="#subject-authenticated-user" class="nomunge">Subject (Authenticated User)</a></li>
      <li><a href="#audience-resource-provider" class="nomunge">Audience (Resource Provider)</a></li>
      <li><a href="#resource-type" class="nomunge">Resource Type</a></li>
      <li><a href="#resource-name" class="nomunge">Resource Name</a></li>
      <li><a href="#resource-actions" class="nomunge">Resource Actions</a></li>
    </ul>
  </li>
  <li><a href="#authorization-server-use" class="nomunge">Authorization Server Use</a>
    <ul>
      <li><a href="#resource-scope-grammar" class="nomunge">Resource Scope Grammar</a></li>
    </ul>
  </li>
  <li><a href="#resource-provider-use" class="nomunge">Resource Provider Use</a></li>
  <li><a href="#jwt-access-tokens" class="nomunge">JWT Access Tokens</a></li>
  <li><a href="#refresh-tokens" class="nomunge">Refresh Tokens</a></li>
</ul>

</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="footer">
          
    <div class="container">
        <div class="top_footer">
            <div class="row">
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/why-docker">Why Docker?</a></b></li>
                        <li><a href="https://www.docker.com/what-container">What is a Container?</a></li>
                        <li><a href="https://docker.events.cube365.net/dockercon/">DockerCon</a></li>
                        <li><b><a href="https://www.docker.com/products/overview">Products</a></b></li>
                        <li><a href="https://www.docker.com/products/docker-desktop">Docker Desktop</a></li>
                        <li><a href="https://www.docker.com/products/docker-hub">Docker Hub</a></li>
                        <li><a href="https://www.docker.com/roadmap">Docker Product Roadmap</a></li>
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Features</a></b></li>
                        <li><a href="https://www.docker.com/products/container-runtime">Container Runtime</a></li>
                        <li><a href="https://www.docker.com/products/developer-tools">Developer Tools</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Developers</a></b></li>
                        <li><a href="https://www.docker.com/use-cases">Use Cases</a></li>
                        <li><a href="https://www.docker.com/docker-community">Community</a></li>
                        <li><a href="https://www.docker.com/open-source">Open Source</a></li>
                        <li><a href="https://www.docker.com/community/docker-captains">Docker Captains</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/products/docker-desktop">Pricing</a></b></li>
                        <li><a href="https://www.docker.com/pricing/faq">FAQs</a></li>
                        <li><a href="https://www.docker.com/partners/programs">Docker Verified Publisher Program</a></li>
                    </ul>
                </div>
                <div class="col-xs-12 col-sm-3 col-md-3">
                    <ul class="footer_links">
                        <li><b><a href="https://www.docker.com/company" target="_blank" rel="noopener">Company</a></b></li>
                        <li><a href="https://www.docker.com/company">About Us</a></li>
                        <li><a href="https://www.docker.com/blog/" target="_blank" rel="noopener">Blog</a></li>
                        <li><a href="https://www.docker.com/customers">Customers</a></li>
                        <li><a href="https://www.docker.com/partners">Partners</a></li>
                        <li><a href="https://www.docker.com/company/newsroom">Newsroom</a></li>
                        <li><a href="https://www.docker.com/careers">Careers</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-nav">
                <nav class="footer_sub_nav">
                    <ul class="menu">
                        <li><a href="http://status.docker.com/">Status</a></li>
                        <li><a href="https://www.docker.com/legal">Legal</a></li>
                        <li><a href="https://www.docker.com/company/contact">Contact</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        <div class="bottom_footer">
            <div class="footer-copyright col-xs-12 col-md-8">
                <p class="copyright">
                    Copyright &copy; 2013-2021 Docker Inc. All rights reserved. </p>
            </div>
            <div class="footer_social_nav">
                <ul class="nav-social">
                    <li class="fa fa-twitter"><a href="http://twitter.com/docker">Twitter</a></li>
                    <li class="fa fa-youtube"><a href="http://www.youtube.com/user/dockerrun">Youtube</a></li>
                    <li class="fa fa-github"><a href="https://github.com/docker">GitHub</a></li>
                    <li class="fa fa-linkedin"><a href="https://www.linkedin.com/company/docker">Linkedin</a></li>
                    <li class="fa fa-facebook"><a href="https://www.facebook.com/docker.run">Facebook</a></li>
                    <li class="fa fa-slideshare"><a href="https://www.slideshare.net/docker">Slideshare</a></li>
                    <li class="fa fa-reddit"><a href="https://www.reddit.com/r/docker">Reddit</a></li>
                </ul>
            </div>
        </div>
    </div>

    </footer>
    <script>const pageURL = "/registry/spec/auth/scope/";</script><script>
    let PDRTJS_settings_8453675 = {
        "id": "8453675",
        "unique_id": "registry/spec/auth/scope.md",
        "title": "Token Scope Documentation",
        "font_family": "Open Sans, sans serif",
        "font_color": "b9c2cc",
        "font_align": "center",
        "permalink": "https://github.com/docker/docker.github.io/blob/master/registry/spec/auth/scope.md"
    };
    (function (d, c, j) {
        if (!document.getElementById(j)) {
            let pd=d.createElement(c),s;pd.id=j;pd.src='https://polldaddy.com/js/rating/rating.js';s=document.getElementsByTagName(c)[0];s.parentNode.insertBefore(pd, s);
        }
    }(document, 'script', 'pd-rating-js'));
</script></body>
</html>
